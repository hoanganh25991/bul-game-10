<!doctype html>
<html lang="en" class="splash-active">

<head>
  <meta charset="utf-8" />
  <title>GoT RPG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover" />
  <script src="lock-zoom.js"></script>
  <link rel="preconnect" href="https://unpkg.com" />
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/landscape.css" />
  <meta name="theme-color" content="#0b1a2b" />
  <link rel="icon"
    href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='12' ry='12' fill='%230b1a2b'/%3E%3Cpath d='M36 4 L12 40 h16 l-4 20 28-40 H36 Z' fill='%23ffffff'/%3E%3C/svg%3E" />
</head>

<body>
  <!-- Three.js renderer will append its canvas to body and sit under UI -->
  <!-- Landscape requirement overlay (visible in portrait only via CSS) -->
  <div id="rotateOverlay" class="rotate-overlay" role="dialog" aria-modal="true" aria-live="polite">
    <div>
      <div style="font-size:48px;margin-bottom:12px;">üîÑ</div>
      <h2>Rotate device</h2>
      <p>Please use landscape orientation to play.</p>
    </div>
  </div>

  <!-- UI/HUD Overlay -->
  <div id="hud">
    <div id="stats">
      <div class="bar hp">
        <div class="fill" id="hpFill"></div>
        <div class="label"><span>HP</span><span id="hpText">100/100</span></div>
      </div>
      <div class="bar mp">
        <div class="fill" id="mpFill"></div>
        <div class="label"><span>MP</span><span id="mpText">100/100</span></div>
      </div>
      <div class="bar xp">
        <div class="fill" id="xpFill"></div>
        <div class="label"><span>XP</span><span id="xpText">0/100</span></div>
      </div>
      <div id="level">Lv <span id="levelValue">1</span></div>
    </div>
  </div>

  <!-- Top-right flex group: minimap above screen buttons -->
  <div id="topRightGroup">
    <!-- Minimap -->
    <canvas id="minimap" width="180" height="180"></canvas>
    <!-- Screen buttons row (below minimap) -->
    <div id="screenGroup">
      <button id="btnInstructionGuide" class="icon-btn" title="Guide">‚úã</button>
      <button id="btnHeroScreen" class="icon-btn" aria-label="Hero" title="Hero">üëπ</button>
      <button id="btnSettingsScreen" class="icon-btn" aria-label="Settings" title="C√†i ƒë·∫∑t / Settings">‚öôÔ∏è</button>
    </div>
  </div>

  <!-- Hints -->
  <div id="hints" style="display:none;">
    <div>DOTA-style controls:</div>
    <div>- Left Click: attack</div>
    <div>- Right Click: move</div>
    <div>- Q/W/E/R: skills</div>
    <div>- S: Stop (cancel orders)</div>
    <div>- B: Recall to village (opens portal back)</div>
  </div>

  <div id="deathMsg" class="center-msg" style="display:none;">You died. Respawning...</div>

  <!-- Settings Panel (now full-screen system screen) -->
  <div id="settingsPanel" class="screen hidden system-screen" role="dialog" aria-modal="true"
    aria-labelledby="settingsTitle">
    <div class="screen-content">
      <div class="panel-header">
        <h2 id="settingsTitle" data-i18n="settings.title">C√†i ƒë·∫∑t</h2>
        <button id="btnCloseSettings" class="icon-btn small screen-close" aria-label="Close">‚úï</button>
      </div>
      <div class="panel-content">
        <div class="row">
          <span class="row-label" data-i18n="settings.language">Ng√¥n ng·ªØ</span>
          <div class="lang-switch">
            <button class="flag" id="langVi" title="Ti·∫øng Vi·ªát" aria-label="Ti·∫øng Vi·ªát">üáªüá≥</button>
            <button class="flag" id="langEn" title="English" aria-label="English">üá∫üá∏</button>
          </div>
        </div>
        <div class="row">
          <span class="row-label" data-i18n="settings.instructions">H∆∞·ªõng d·∫´n</span>
          <div class="instructions" id="settingsInstructions"></div>
        </div>

        <div class="row">
          <span class="row-label">M√¥i tr∆∞·ªùng</span>
          <div class="env-controls" style="display:flex;flex-direction:column;gap:8px;">
            <label style="display:flex;align-items:center;gap:8px;">
              <input type="checkbox" id="envRainToggle" /> <span data-i18n="settings.env.rain">Rain</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;">
              <span style="font-size:12px;color:#bfe5ff;margin-right:8px;" data-i18n="settings.env.density">Density</span>
              <input type="range" id="envDensity" min="1" max="10" step="1" value="5" />
            </label>
            <label style="display:flex;align-items:center;gap:8px;">
              <span style="font-size:12px;color:#bfe5ff;margin-right:8px;" data-i18n="settings.env.rainDensity">Rain Density</span>
              <input type="range" id="rainDensity" min="1" max="10" step="1" value="5" />
            </label>
            <label style="display:flex;align-items:center;gap:8px;">
              <span style="font-size:12px;color:#bfe5ff;margin-right:8px;" data-i18n="settings.render.zoom">Zoom</span>
              <input type="range" id="zoomSlider" min="1" max="10" step="1" value="5" />
            </label>
            <label style="display:flex;align-items:center;gap:8px;">
              <span style="font-size:12px;color:#bfe5ff;margin-right:8px;" data-i18n="settings.render.quality">Quality</span>
              <select id="qualitySelect" aria-label="Quality">
                <option value="low" data-i18n="settings.render.low">Low</option>
                <option value="medium" data-i18n="settings.render.medium">Medium</option>
                <option value="high" data-i18n="settings.render.high">High</option>
              </select>
            </label>
          </div>
        </div>

        <div class="row">
          <span class="row-label">√Çm thanh / Sound</span>
          <div class="sound-controls" style="display:flex;flex-direction:column;gap:8px;">
            <label style="display:flex;align-items:center;gap:8px;">
              <input type="checkbox" id="musicToggle" /> <span>Music</span>
            </label>
            <label style="display:flex;align-items:center;gap:8px;">
              <input type="checkbox" id="sfxToggle" /> <span>SFX</span>
            </label>
          </div>
        </div>
      </div>
      <div class="panel-footer"></div>
    </div>
  </div>

  <!-- Hero Screen -->
  <div id="heroScreen" class="screen hidden system-screen" role="dialog" aria-modal="true" aria-labelledby="heroTitle">
    <div class="screen-content">
      <div class="panel-header">
        <h2 id="heroTitle" data-i18n="hero.title">Zeus</h2>
        <button class="icon-btn small screen-close" aria-label="Close">‚úï</button>
      </div>
      <div class="panel-content"></div>
      <div class="panel-footer"></div>
    </div>
  </div>

  <!-- Flash overlay (visible by default to ensure coverage before JS runs) -->
  <div id="flashOverlay" class="flash" style="display: grid;">
    <div class="flash-card" role="status" aria-live="polite" aria-busy="true">
      <h2 class="flash-title" data-i18n="flash.title">ƒêang t·∫£i Th·∫ßn S·∫•m M√£i ƒê·ªânh</h2>
      <div class="flash-subtitle" aria-hidden="true" style="font-size:12px;opacity:0.8;margin-top:2px;">Thunder God ‚Äî
        Always Peak</div>
      <p class="flash-desc" data-i18n="flash.desc">Chu·∫©n b·ªã tr·∫£i nghi·ªám s·∫•m s√©t‚Ä¶</p>
      <div class="progress" aria-hidden="false">
        <div class="bar" id="flashProgressBar" style="width: 0%" role="progressbar" aria-valuemin="0"
          aria-valuemax="100" aria-valuenow="0"></div>
      </div>
      <div class="flash-note" style="margin-top:10px;font-size:12px;color:rgba(10,10,10,0.5)" data-i18n="flash.note">
        Loading modules‚Ä¶</div>

      <!-- Start screen (shown after splash completes) -->
      <div id="startScreen" class="start-screen" style="display:none; margin-top:12px;">
        <h2 id="startTitle" data-i18n="start.title">H√†nh tr√¨nh c·ªßa Th·∫ßn S·∫•m</h2>
        <p id="startStory" data-i18n="start.story">Th·∫ø gi·ªõi ch√¨m trong u √°m. Nh·ªØng b√≥ng ƒë√™m t·ªânh d·∫≠y, v√† ch·ªâ m·ªôt v·ªã th·∫ßn
          c√≥ th·ªÉ g·ªçi s·∫•m s√©t tr·ªü l·∫°i. H√£y d·∫´n Zeus ‚Äî v·ªã th·∫ßn s·∫•m ‚Äî qua r·ª´ng hoang, l√†ng m·∫°c ƒë·ªï n√°t v√† chi·∫øn tr∆∞·ªùng, ti√™u
          di·ªát l≈© qu√°i v√† kh√¥i ph·ª•c tr·∫≠t t·ª±.</p>
        <button id="btnStartGame" class="primary" data-i18n="btn.start">B·∫Øt ƒë·∫ßu</button>
      </div>
    </div>
  </div>

  <!-- Mobile Touch Controls -->
  <div id="bottomLeftGroup">
    <!-- Joystick (bottom-left) -->
    <div id="joystick">
      <div id="joyBase"></div>
      <div id="joyKnob"></div>
      <!-- Small cancel aim button positioned above joystick -->
      <!-- <button id="btnCancelAim" class="small">Cancel</button> -->
    </div>
  </div>

  <!-- Bottom-right flex group: core controls above skill wheel -->
  <div id="bottomRightGroup">
    <div id="coreSkillGroup">
      <!-- Camera toggle -->
      <button id="btnCamera" class="icon-btn" aria-label="Camera Toggle" title="Camera">üé•</button>
      <!-- Portal button -->
      <button id="btnPortal" class="icon-btn" aria-label="Portal" title="Portal">üåÄ</button>
      <!-- Mark/Flag button -->
      <button id="btnMark" class="icon-btn" aria-label="Mark" title="Mark (3m cd)">üö©</button>
    </div>

    <!-- Skill wheel (kept as bottom item in the column) -->
    <div id="skillWheel">
      <button id="btnBasic" class="skill-btn center" title="Basic">
        <span class="icon">‚ö°</span>
        <div class="cooldown" id="cdBasic"></div>
      </button>

      <button id="btnSkillQ" class="skill-btn q" title="Q">
        <span class="icon"></span>
        <span class="key">Q</span>
        <span class="name"></span>
        <div class="cooldown" id="cdQ"></div>
      </button>

      <button id="btnSkillW" class="skill-btn w" title="W">
        <span class="icon"></span>
        <span class="key">W</span>
        <span class="name"></span>
        <div class="cooldown" id="cdW"></div>
      </button>

      <button id="btnSkillE" class="skill-btn e" title="E">
        <span class="icon"></span>
        <span class="key">E</span>
        <span class="name"></span>
        <div class="cooldown" id="cdE"></div>
      </button>

      <button id="btnSkillR" class="skill-btn r" title="R">
        <span class="icon"></span>
        <span class="key">R</span>
        <span class="name"></span>
        <div class="cooldown" id="cdR"></div>
      </button>
    </div>
  </div>

  <!-- Module game code -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js"
      }
    }
    </script>
  <script type="module" src="src/main.js"></script>
</body>

</html>
